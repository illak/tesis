{"paragraphs":[{"text":"\n//Dataframe de artistas\nval artists_df = spark.read.parquet(\"/home/illak/tesis/artists.parquet\")\n\nval all_artist_df = artists_df\n                        .withColumn(\"artist_name\", $\"name\")\n                        .withColumn(\"artist_discogs_id\",$\"id\")\n                        .select(\"artist_name\",\"artist_discogs_id\",\"members\")\n                        \n//Dataframe de releases\nval jazz_releases = spark.read.parquet(\"/home/illak/tesis/jazz_releases.parquet\")\n\n//Chequeo que son releases con genero Jazz\njazz_releases.select($\"genres\").show(false)","dateUpdated":"2017-05-04T13:48:37-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495810_1031380630","id":"20170503-163636_1104878725","dateCreated":"2017-05-04T13:48:15-0300","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2907","user":"anonymous","dateFinished":"2017-05-04T13:49:20-0300","dateStarted":"2017-05-04T13:48:37-0300","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nartists_df: org.apache.spark.sql.DataFrame = [id: bigint, name: string ... 1 more field]\n\nall_artist_df: org.apache.spark.sql.DataFrame = [artist_name: string, artist_discogs_id: bigint ... 1 more field]\n\njazz_releases: org.apache.spark.sql.DataFrame = [_id: bigint, title: string ... 5 more fields]\n+-------------------------------------------------+\n|genres                                           |\n+-------------------------------------------------+\n|[WrappedArray(Jazz, Funk / Soul, Stage & Screen)]|\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz, Funk / Soul, Blues)]         |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz, Pop)]                        |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Electronic, Jazz, Rock)]           |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz, Folk, World, & Country)]     |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Jazz, Pop, Stage & Screen)]        |\n|[WrappedArray(Jazz)]                             |\n|[WrappedArray(Hip Hop, Jazz)]                    |\n|[WrappedArray(Jazz)]                             |\n+-------------------------------------------------+\nonly showing top 20 rows\n\n"}]}},{"text":"//Limpiamos\n\nval jazz_rel_clean = jazz_releases.na.fill(\"no info\", Seq(\"released\",\"country\"))\n                        .withColumnRenamed(\"_id\", \"discogs_id\")\n                        .withColumn(\"artists_names\", $\"artists\".getItem(\"artist\").getItem(\"name\"))\n                        .withColumn(\"artists_ids\", $\"artists\".getItem(\"artist\").getItem(\"id\"))\n                        .withColumn(\"genres\", $\"genres\".getItem(\"genre\"))\n                        .withColumn(\"extras_names\", $\"extraartists\".getItem(\"artist\").getItem(\"name\"))\n                        .withColumn(\"extras_roles\", $\"extraartists\".getItem(\"artist\").getItem(\"role\"))\n                        .withColumn(\"extras_ids\", $\"extraartists\".getItem(\"artist\").getItem(\"id\"))\n                        \njazz_rel_clean.select(\"discogs_id\",\"title\",\"artists_names\",\"artists_ids\",\"released\").show()","dateUpdated":"2017-05-04T13:48:42-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495819_1027917890","id":"20170503-163810_1883859585","dateCreated":"2017-05-04T13:48:15-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2908","user":"anonymous","dateFinished":"2017-05-04T13:49:23-0300","dateStarted":"2017-05-04T13:48:42-0300","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\njazz_rel_clean: org.apache.spark.sql.DataFrame = [discogs_id: bigint, title: string ... 10 more fields]\n+----------+--------------------+--------------------+--------------------+----------+\n|discogs_id|               title|       artists_names|         artists_ids|  released|\n+----------+--------------------+--------------------+--------------------+----------+\n|   6321180|Our Man Flint / T...|       [Herbie Mann]|             [30721]|   no info|\n|   6321213|        Back To Back|[The Brecker Brot...|             [30007]|      1976|\n|   6321238|        Spotlight On|[Glenn Miller, Th...|    [77991, 2220093]|      1994|\n|   6321243|Rare / Unissued R...|    [Billie Holiday]|             [33589]|      1990|\n|   6321245|I Loves You Porgy...|       [Nina Simone]|             [10584]|   no info|\n|   6321247|          At Newport|[Teddy Wilson Tri...|[344326, 375978, ...|1978-08-00|\n|   6321250|The Story Of Lee ...|        [Lee Towers]|            [378655]|      1987|\n|   6321263|F.Y.I. Featuring ...|   [Charlie Ventura]|            [262140]|   no info|\n|   6321293|The Greatest Ente...|         [Al Jolson]|            [258519]|      1994|\n|   6321299|             Fantasy|      [Luxury Elite]|           [3130842]|      2014|\n|   6321316|Sometimes I Feel ...|[Fats Waller, The...|   [253482, 4151386]|1947-03-00|\n|   6321351|Another Evening W...|   [Charlie Ventura]|            [262140]|   no info|\n|   6321361|          Høgtidsrom| [Beate Lech, SKRUK]|    [379503, 690028]|2014-11-14|\n|   6321378|     The Magic Touch|[Tadd Dameron And...|            [344335]|      1962|\n|   6321410|There'll Be Some ...|[Chicago Rhythm K...|           [2034453]|   no info|\n|   6321420|Charlie Venturas ...|[Charlie Ventura'...|   [5658912, 262140]|   no info|\n|   6321425|Honky Donkey Blue...|  [Vincenzo Tempera]|            [449900]|      1976|\n|   6321446|Amour, Danse Et V...|[Franck Pourcel E...|            [443337]|      1964|\n|   6321452|New Sounds In Mod...|   [Charlie Ventura]|            [262140]|   no info|\n|   6321456|  Skokiaan / Say Hey|[Ray Anthony & Hi...|            [339572]|      1954|\n+----------+--------------------+--------------------+--------------------+----------+\nonly showing top 20 rows\n\n"}]}},{"text":"//Dataframe de colaboraciones (Creditos)\n\nval jazz_colabs = jazz_rel_clean.na.drop(Seq(\"extras_names\"))\n                        .withColumn(\"name_id_role\", explode(zip_udf($\"extras_names\", $\"extras_roles\", $\"extras_ids\")))\n                        .select(\n                            $\"title\",\n                            $\"released\",\n                            $\"country\",\n                            $\"discogs_id\",\n                            $\"name_id_role._1\".alias(\"colab_name\"), $\"name_id_role._2._1\".alias(\"colab_id\"),\n                            $\"name_id_role._2._2\".alias(\"colab_role\"))\n                            .withColumn(\"colab_name\", trim($\"colab_name\"))\n                            .withColumn(\"colab_name\", lower($\"colab_name\"))\n                            .withColumn(\"colab_name\", regexp_replace($\"colab_name\", \"&\", \"&amp;\"))\n                            .withColumn(\"colab_name\", regexp_replace($\"colab_name\", \"\\\"\", \"&quot;\"))\n                            .withColumn(\"colab_name\", regexp_replace($\"colab_name\", \"<\", \"&lt;\"))\n                            .withColumn(\"colab_name\", regexp_replace($\"colab_name\", \">\", \"&gt;\"))\n                            .withColumn(\"colab_name\", regexp_replace($\"colab_name\", \"　\", \"\"))\n\njazz_colabs.show()","dateUpdated":"2017-05-04T13:48:55-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495822_1026763643","id":"20170503-163837_1541999114","dateCreated":"2017-05-04T13:48:15-0300","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:2909","user":"anonymous","dateFinished":"2017-05-04T13:49:24-0300","dateStarted":"2017-05-04T13:49:21-0300","results":{"code":"ERROR","msg":[{"type":"TEXT","data":"\n\n\n<console>:32: error: not found: value zip_udf\n                               .withColumn(\"name_id_role\", explode(zip_udf($\"extras_names\", $\"extras_roles\", $\"extras_ids\")))\n                                                                   ^\n"}]}},{"text":"//Dataframe de los artistas principales (no creditos)\n\nval jazz_main_art = jazz_rel_clean\n                        .withColumn(\"artist_name\", explode($\"artists_names\"))\n                        .select(\n                            $\"title\",\n                            $\"discogs_id\",\n                            $\"artist_name\")\n\n\nval main_artists = jazz_main_art.join(all_artist_df, Seq(\"artist_name\"), \"left_outer\")\n                        .withColumn(\"artist_name\", trim($\"artist_name\"))\n                        .withColumn(\"artist_name\", lower($\"artist_name\"))\n                        .withColumn(\"artist_name\", regexp_replace($\"artist_name\", \"&\", \"&amp;\"))\n                        .withColumn(\"artist_name\", regexp_replace($\"artist_name\", \"\\\"\", \"&quot;\"))\n                        .withColumn(\"artist_name\", regexp_replace($\"artist_name\", \"<\", \"&lt;\"))\n                        .withColumn(\"artist_name\", regexp_replace($\"artist_name\", \">\", \"&gt;\"))\n                        .withColumn(\"title\", regexp_replace($\"title\", \"&\", \"&amp;\"))\n                        .withColumn(\"title\", regexp_replace($\"title\", \"\\\"\", \"&quot;\"))\n                        .withColumn(\"title\", regexp_replace($\"title\", \">\", \"&gt;\"))\n                        .withColumn(\"title\", regexp_replace($\"title\", \"<\", \"&lt;\"))\n\nmain_artists.show()","dateUpdated":"2017-05-04T13:50:45-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495825_1036382366","id":"20170503-163913_1492490433","dateCreated":"2017-05-04T13:48:15-0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2910","user":"anonymous","dateFinished":"2017-05-04T13:51:18-0300","dateStarted":"2017-05-04T13:50:45-0300","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\njazz_main_art: org.apache.spark.sql.DataFrame = [title: string, discogs_id: bigint ... 1 more field]\n\nmain_artists: org.apache.spark.sql.DataFrame = [artist_name: string, title: string ... 3 more fields]\n+-------------+--------------------+----------+-----------------+--------------------+\n|  artist_name|               title|discogs_id|artist_discogs_id|             members|\n+-------------+--------------------+----------+-----------------+--------------------+\n|          ...|             Dynamic|   9618579|           892287|                null|\n|14 karat soul|   The Girl In White|   7057519|           108696|[WrappedArray(416...|\n|          17f|        Tree Of Them|   3407529|          2622650|[WrappedArray(254...|\n|18ème boudoir|Le Cycle Des Lumi...|   4072175|          2222370|                null|\n|18ème boudoir|Le Cycle Des Lumi...|   4072210|          2222370|                null|\n|18ème boudoir|Le Cycle Des Lumi...|   4072216|          2222370|                null|\n| a coral room|                 IoT|   6953909|          4381369|                null|\n|         avvi|Subtle Mental Mec...|   4759151|          3310959|                null|\n|aarno raninen|Onni Tai Kai / Al...|   2937590|           644338|                null|\n|aarno raninen|      Aurinko Nousee|   6086831|           644338|                null|\n|aarno raninen|On Hetki / Salain...|   2450793|           644338|                null|\n|aarno raninen|       Aarno Raninen|   1948627|           644338|                null|\n|aarno raninen|  Credo - Minä Uskon|   2711669|           644338|                null|\n|aarno raninen|Suosikki Säveliä ...|   3172329|           644338|                null|\n|     ab baars|              Circus|   2394089|           424421|                null|\n|     ab baars|     Give No Quarter|   4793564|           424421|                null|\n|     ab baars|Live @ The Jazz H...|   8581776|           424421|                null|\n|     ab baars|O.Ba.O. Meets Ab ...|   4778522|           424421|                null|\n|     ab baars|                  OX|   3959998|           424421|                null|\n|     ab baars|               Krang|   2955090|           424421|                null|\n+-------------+--------------------+----------+-----------------+--------------------+\nonly showing top 20 rows\n\n"}]}},{"text":"//PROBANDO NUEVA DB (FORMA 1)\n\n// Actualmente se esta usando esta forma.\n// La idea es generar nodos de tipo Artista\n// y relaciones :TOCO_CON con atributos (\"titulo del release\", \"en calidad de que toco con (rol)\", \"pais\", \"año\")\n// tal que:\n//\n// (artista_x)---[:TOCO_CON]-->(artista_y)\n// esto mejora la visualizacion ya que no hay varios tipos de nodos y existe una unica relación.\n\nval new_relations = jazz_colabs\n                            .select(\"colab_name\",\"colab_id\",\"title\",\"colab_role\",\"discogs_id\",\"released\",\"country\")\n                            .join(main_artists.select(\"discogs_id\",\"artist_name\",\"artist_discogs_id\"),\n                                    Seq(\"discogs_id\"), \"left_outer\")\n                            .where($\"artist_discogs_id\".isNotNull)\n\n\nval relations = new_relations\n                            .where($\"colab_id\" =!= 0)\n                            .dropDuplicates()\n                            .withColumn(\":START_ID(Artist)\", $\"colab_id\")\n                            .withColumn(\":END_ID(Artist)\", $\"artist_discogs_id\")\n                            .withColumn(\"role\", $\"colab_role\")\n                            .withColumn(\"year\", $\"released\")\n                            .select(\":START_ID(Artist)\", \":END_ID(Artist)\", \"role\",\"title\",\"year\",\"country\")\n                            .where($\":START_ID(Artist)\" =!= $\":END_ID(Artist)\")\n                            \nval artist_nodes =  main_artists.select(\"artist_name\",\"artist_discogs_id\")\n                                    .where($\"artist_discogs_id\".isNotNull)\n                                    .withColumn(\"artistId:ID(Artist)\", $\"artist_discogs_id\")\n                                    .withColumn(\"name\", $\"artist_name\").select(\"artistId:ID(Artist)\",\"name\")\n                                    .dropDuplicates\n\nval collaborators = jazz_colabs\n                            .where($\"colab_id\".isNotNull)\n                            .where($\"colab_id\" =!= 0)\n                            .withColumn(\"artistId:ID(Artist)\", $\"colab_id\")\n                            .withColumn(\"name\", $\"colab_name\").select(\"artistId:ID(Artist)\", \"name\")\n                            .dropDuplicates()\n                            \nval nodes = artist_nodes.union(collaborators).dropDuplicates()\n\n\n// GENERAMOS CSVs\nnodes.repartition(1).write\n                    .format(\"com.databricks.spark.csv\")\n                    .option(\"header\", \"true\")\n                    .save(\"discogs_csvs/artists\")\n\nrelations.repartition(1).write\n                    .format(\"com.databricks.spark.csv\")\n                    .option(\"header\", \"true\")\n                    .save(\"discogs_csvs/relations\")\n\n\n// CORREGIMOS NOMBRE DE LOS ARCHIVOS (ya que se generan con la pinta: part-0000...):\nimport org.apache.hadoop.fs._\n\nvar fs = FileSystem.get(sc.hadoopConfiguration)\nvar file = fs.globStatus(new Path(\"discogs_csvs/artists/part*\")).apply(0).getPath().getName()\n\nfs.rename(new Path(\"discogs_csvs/artists/\" + file), new Path(\"discogs_csvs/artists.csv\"))\nfs.delete(new Path(\"discogs_csvs/artists/artists.csv-temp\"), true)\nfs.delete(new Path(\"discogs_csvs/artists/\"), true)\n\nfile = fs.globStatus(new Path(\"discogs_csvs/relations/part*\")).apply(0).getPath().getName()\n\nfs.rename(new Path(\"discogs_csvs/relations/\" + file), new Path(\"discogs_csvs/relations.csv\"))\nfs.delete(new Path(\"discogs_csvs/relations/relations.csv-temp\"), true)\nfs.delete(new Path(\"discogs_csvs/relations/\"), true)","dateUpdated":"2017-05-04T13:48:15-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495827_1037151864","id":"20170503-163948_1650948585","dateCreated":"2017-05-04T13:48:15-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2911"},{"text":"//===========================================FORMA 2 (inicial)=================================================","dateUpdated":"2017-05-04T13:48:15-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495829_1034843370","id":"20170503-164537_1381186812","dateCreated":"2017-05-04T13:48:15-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2912"},{"text":"// FORMA 2\n// La idea es generar 3 tipos de nodos: Artistas (principales), Colaboradores, Releases\n// Con 2 tipos de relaciones hacia un release: :PERFORMED_IN (toco en) y :CREDITS_IN (colaboro en/tiene creditos en)\n// tal que:\n// (Artista)---[:PERFORMED_IN]-->(Release)\n// (Colabodor)---[:CREDITS_IN]-->(Release)\n//\n// de esta manera no queda nadie fuera de la bd pero la visualización se vuelve confusa debido a la ocurrencia de varios tipos de nodos\n\n\nval artist_nodes =  main_artists.select(\"artist_name\",\"artist_discogs_id\")\n                                    .dropDuplicates\n                                    .where($\"artist_discogs_id\".isNotNull)\n                                    .withColumn(\"artistId:ID(Artist)\", $\"artist_discogs_id\")\n                                    .withColumn(\"name\", $\"artist_name\").select(\"artistId:ID(Artist)\",\"name\")\n\nartist_nodes.show()\n\nval releases_nodes = jazz_rel_clean\n                        .withColumn(\"releaseId:ID(Release)\", $\"discogs_id\").select(\"releaseId:ID(Release)\",\"title\",\"country\",\"released\")\n                        .dropDuplicates\n\nreleases_nodes.show()\n\nval relationships_main = main_artists\n                            .where($\"artist_discogs_id\".isNotNull)\n                            .withColumn(\":START_ID(Artist)\", $\"artist_discogs_id\")\n                            .withColumn(\":END_ID(Release)\", $\"discogs_id\")\n                            .select(\":START_ID(Artist)\",\":END_ID(Release)\")\n\nrelationships_main.show()\n\n\nval collaborators = jazz_colabs\n                            .where($\"colab_id\".isNotNull)\n                            .where($\"colab_id\" =!= 0)\n                            .withColumn(\"collabId:ID(Collaborator)\", $\"colab_id\")\n                            .withColumn(\"name\", $\"colab_name\").select(\"collabId:ID(Collaborator)\", \"name\")\n                            .dropDuplicates()\n                            \ncollaborators.show()\nval relationships_collab = jazz_colabs\n                                .where($\"colab_id\".isNotNull)\n                                .where($\"colab_id\" =!= 0)\n                                .dropDuplicates()\n                                .withColumn(\":START_ID(Collaborator)\", $\"colab_id\")\n                                .withColumn(\":END_ID(Release)\", $\"discogs_id\")\n                                .withColumn(\"role\", $\"colab_role\")\n                                .select(\":START_ID(Collaborator)\", \":END_ID(Release)\", \"role\")\n                                \nrelationships_collab.show()\n","dateUpdated":"2017-05-04T13:48:15-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495831_1035612868","id":"20170503-164244_1836689688","dateCreated":"2017-05-04T13:48:15-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2913"},{"text":"// Forma 2 --> csv\n\nartist_nodes.repartition(1).write\n                    .format(\"com.databricks.spark.csv\")\n                    .option(\"header\", \"true\")\n                    .save(\"discogs_csvs/artists\")\n\nreleases_nodes.repartition(1).write\n                    .format(\"com.databricks.spark.csv\")\n                    .option(\"header\", \"true\")\n                    .save(\"discogs_csvs/releases\")\n\nrelationships_main.repartition(1).write\n                    .format(\"com.databricks.spark.csv\")\n                    .option(\"header\", \"true\")\n                    .save(\"discogs_csvs/relationships_main\")\n                    \ncollaborators.repartition(1).write\n                    .format(\"com.databricks.spark.csv\")\n                    .option(\"header\", \"true\")\n                    .save(\"discogs_csvs/collaborators\")\n                    \nrelationships_collab.repartition(1).write\n                    .format(\"com.databricks.spark.csv\")\n                    .option(\"header\", \"true\")\n                    .save(\"discogs_csvs/relationships_collab\")","dateUpdated":"2017-05-04T13:48:15-0300","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1493916495833_1033304375","id":"20170503-164510_1021904728","dateCreated":"2017-05-04T13:48:15-0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2914"}],"name":"parquet2csv","id":"2CJ7TQDUK","angularObjects":{"2CBFX6HW1:shared_process":[],"2CCDQTT6Z:shared_process":[],"2CAC1SXNK:shared_process":[],"2CCD9N5DP:shared_process":[],"2CD7EFXF8:shared_process":[],"2CBK18PQK:shared_process":[],"2CADQ1SB6:shared_process":[],"2CDYWNZBU:shared_process":[],"2CBXK2N4N:shared_process":[],"2CC11KCG4:shared_process":[],"2CBBED38Z:shared_process":[],"2CCSM2EG3:shared_process":[],"2CB4ZNHES:shared_process":[],"2CAB4QWCA:shared_process":[],"2CDCS19H5:shared_process":[],"2CE2AJ4JH:shared_process":[],"2CCTDR582:shared_process":[],"2CDX5GXYM:shared_process":[],"2CBMPXBJB:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}